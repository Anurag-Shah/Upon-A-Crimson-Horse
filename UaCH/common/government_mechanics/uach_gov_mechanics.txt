# This is mechanics for both governor and prince
# The prince has an extra one
# We WANT the governor to see the extra one they don't have access to
# This will tempt the player into becoming a prince
# This is a good thing because i like being an evil little goblin and tempting my players into making bad decisions

uach_mechanics = {
	alert_icon_gfx = GFX_alerticons_government_mechanics
	alert_icon_index = 2

	available = {
		# All interactions require the civil war to have started
		has_global_flag = uach_succession_crisis_started
	}
	
	interactions = {
		# Raise support for claimant
		uach_raise_claimant_support = {
			icon = GFX_efficient_tax_farming_button
			cooldown_years = 1
			cooldown_token = iqta_mechanic
			cooldown_desc = UACH_GOV_REFORM_COOLDOWN
			trigger = {
				custom_trigger_tooltip = {
					tooltip = UACH_GOV_RCS_TT
					AND = {
						is_prince = yes
						# at least 1 unoccupied province not under seige
						any_province = {
							AND = {
								controlled_by = PREV
								NOT = {
									has_siege = yes
								}
							}
						}
					}
				}
			}
			effect = {
				add_war_exhaustion = -3
				add_legitimacy = 5
				add_years_of_income = -0.25
				add_prestige = -10
				if = {
					limit = {
						capital_scope = {
							AND = {
								controlled_by = PREV
								NOT = {
									has_siege = yes
								}
							}
						}
					}
					capital_scope = {
						add_unit_construction = {
							type = infantry
							amount = 3
							speed = 0.25
							cost = 0
						}
						add_unit_construction = {
							type = cavalry
							amount = 3
							speed = 0.25
							cost = 0
						}
					}
				}
			}
			ai_chance = {
				# The AI will never do this if they have no loans / a bank of manpower (10% max)
				# Then if they have both loans and manpower, the factor will increase
				# They are unlikely to do it without a defecit
				factor = 10
				modifier = {
					factor = 0
					NOT = {
						num_of_loans = 1
						manpower_percentage = 0.1
					}
				}
				modifier = {
					factor = 0.5
					is_in_deficit = no
				}
				modifier = {
					factor = 2
					num_of_loans = 5
				}
				modifier = {
					factor = 4
					num_of_loans = 10
				}
				modifier = {
					factor = 3
					manpower_percentage = 0.05
				}
				modifier = {
					factor = 4
					manpower_percentage = 0.01
				}
			}
		}



		# Request foreign support
		uach_request_foreign_support = {
			icon = GFX_efficient_tax_farming_button
			cooldown_years = 1
			cooldown_token = iqta_mechanic
			cooldown_desc = UACH_GOV_REFORM_COOLDOWN
			trigger = {
				custom_trigger_tooltip = {
					tooltip = UACH_GOV_RFS_TOOLTIP
					calc_true_if = {
						all_neighbor_country = {
							NOT = {
								is_governor = yes
								is_prince = yes
								is_interloper = yes
							}
						}
						amount = 1
					}
				}
			}
			effect = {
				add_yearly_manpower = 2
				add_years_of_income = 2
				add_legitimacy = -10
				add_prestige = -15
				random_neighbor_country = {
					add_opinon = {
						who = PREV
						modifier = supported_us_in_timurid_success_crisis
					}
					add_prestige = 5
				}
			}
			ai_chance = {
				# The AI will never do this if they have no loans / a bank of manpower (10% max)
				# Then if they have both loans and manpower, the factor will increase
				# They are unlikely to do it without a defecit
				factor = 10
				modifier = {
					factor = 0
					NOT = {
						num_of_loans = 1
						manpower_percentage = 0.1
					}
				}
				modifier = {
					factor = 0.5
					is_in_deficit = no
				}
				modifier = {
					factor = 2
					num_of_loans = 5
				}
				modifier = {
					factor = 4
					num_of_loans = 10
				}
				modifier = {
					factor = 3
					manpower_percentage = 0.05
				}
				modifier = {
					factor = 4
					manpower_percentage = 0.01
				}
			}
		}


		# Conscript men: gain manpower at the cost of income
		uach_conscript_men = {
			icon = GFX_efficient_tax_farming_button
			cooldown_years = 1
			cooldown_token = iqta_mechanic
			cooldown_desc = UACH_GOV_REFORM_COOLDOWN

			effect = {
				add_yearly_manpower = 1
				add_years_of_income = -0.5
			}
			ai_chance = {
				# The AI will never do this if they have a bank of manpower (10% max)
				# The more loans they have, the less likely they are to do it
				# They are unlikely to do it during a defecit
				factor = 10
				modifier = {
					factor = 0
					NOT = {
						manpower_percentage = 0.1
					}
				}
				modifier = {
					factor = 0.5
					is_in_deficit = yes
				}
				modifier = {
					factor = 0.5
					num_of_loans = 5
				}
				modifier = {
					factor = 0.1
					num_of_loans = 10
				}
				modifier = {
					factor = 0
					num_of_loans = 15
				}
				modifier = {
					factor = 2
					manpower_percentage = 0.05
				}
				modifier = {
					factor = 4
					manpower_percentage = 0.01
				}
			}
		}



		# Raise a tax: gain income at the cost of base unrest
		uach_raise_a_tax = {
			icon = GFX_efficient_tax_farming_button
			cooldown_years = 1
			cooldown_token = iqta_mechanic
			cooldown_desc = UACH_GOV_REFORM_COOLDOWN

			effect = {
				add_years_of_income = 1.5
				custom_tooltip = uach_conscript_men_effect_tt
				hidden_effect = {
					every_province = {
						limit = {
							controlled_by = PREV
						}
						add_unrest = 3
					}
				}
			}
			ai_chance = {
				# This is the default choice for the AI, factor will never be 0
				# This is because we like rebels!
				# Rebels are free troops that add random chaos to the civil war
				# This is a good thing
				# Because I am evil
				factor = 10
				modifier = {
					factor = 0.2
					is_in_deficit = no
				}
				modifier = {
					factor = 0.1
					NOT = { num_of_loans = 1 }
				}
				modifier = {
					factor = 2
					num_of_loans = 5
				}
				modifier = {
					factor = 4
					num_of_loans = 10
				}
				modifier = {
					factor = 6
					num_of_loans = 15
				}
			}
		}
	}
}