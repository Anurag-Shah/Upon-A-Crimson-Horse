on_startup = {
    if = {
        limit = {
            NOT = { has_global_flag = uach_init_ui }
            NOT = { is_year = 1448 }
        }
        every_country = {
            limit = {
                OR = {
                    is_prince = yes
                    is_governor = yes
                    is_interloper = yes
                    any_neighbor_country = {
                        OR = {
                            is_prince = yes
                            is_governor = yes                      
                        }
                    }
                }
                NOT = { tag = ORM }
            }
            add_faction = timurid_faction
        }
        init_start_princes = yes
        init_start_governors = yes
        TIM = {
            country_event = {
                id = UaCH.1 
            }
        }
        set_global_flag = uach_init_ui
    }
}

on_annexed = {
    shuffle_princes = { scope = FROM }
    shuffle_governors = { scope = FROM }
}

on_province_owner_change = {
    events = {
        UaCH.28  # Recapture of Herat
    }
}

on_siege_lost_province = {
    if = {
        limit = {
            FROM = {
                tag = KZH
                has_country_flag = kzh_war_of_independence
            }
            culture = khazak
            NOT = { is_core = KZH }
        }
        add_core = KZH
    }
    events = {
        # TODO siege of Samarkand by Abdal-Latif --> Uluq Beg should be executed
    }
}

on_war_won = {
    if = {
        limit = {
            ROOT = {
                tag = KZH
                has_country_flag = kzh_war_of_independence
            }
            FROM = {
                tag = SHY
            }
        }
        every_province = {
            limit = {
                is_core = KZH
                country_or_non_sovereign_subject_holds = SHY
                NOT = {
                    area = kyzylkum_area
                }
            }
            cede_province = KZH
        }
        ROOT = {
            clr_country_flag = kzh_war_of_independence
        }
        FROM = {
            country_event = {
                id = UaCH.88
            }
        }
    }
    FROM = {
        country_event = {
            id = UaCH.80
            days = 1
        }
    }
    if = {
        ROOT = {
            AND = {
                tag = TIM
                has_country_flag = uach_interwar_lull
            }
        }
        country_event = {
            id = UaCH.100
        }
    }
}

on_war_lost = {
    if = {
        limit = {
            ROOT = {
                tag = KZH
                has_country_flag = kzh_war_of_independence
            }
            FROM = {
                tag = SHY
            }
        }
        ROOT = {
            clr_country_flag = kzh_war_of_independence
        }
    }   
}

on_battle_lost_unit = {
    if = {
        limit = {
            unit_owner = {
                OR = {
                    is_in_war = { casus_belli = cb_challange_claimant }
                    is_in_war = { casus_belli = cb_enforce_loyalty_governor }
                }
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            random_list = {
                25 = { country_event = { id = UaCH.43 } }
                75 = { }
            }
        }
    }
}